<!DOCTYPE html>
<html lang="en" data-accent-color="bronze" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Time-based Rules - litestar-flags</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Multi-Environment Support" href="multi-environment.html" /><link rel="prev" title="OpenFeature Integration" href="openfeature.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=a318c5d4" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=18eed9c1" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="Time-based Rules"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>litestar-flags</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link">
          <a href="https://litestar.dev/">
            <span>Litestar</span></a>
        </li><li class="link">
          <a href="https://pypi.org/project/litestar-flags/">
            <span>PyPI</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/JacobCoffee/litestar-flags" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/quickstart.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/configuration.html">Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">How-To Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/storage-backends.html">Storage Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/percentage-rollouts.html">Percentage Rollouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/user-targeting.html">User Targeting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/ab-testing.html">A/B Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/environments.html">Multi-Environment Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/testing.html">Testing with Feature Flags</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/client.html">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/context.html">Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/config.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/storage.html">Storage Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/decorators.html">Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/types.html">Types and Enums</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/analytics.html">Analytics</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Integrations</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="segments.html">Segment-based Targeting</a></li>
<li class="toctree-l2"><a class="reference internal" href="openfeature.html">OpenFeature Integration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Time-based Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi-environment.html">Multi-Environment Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="analytics.html">Flag Analytics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage/admin-api.html">Admin API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/workflows.html">Approval Workflows</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/JacobCoffee/litestar-flags">GitHub</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#what-are-time-based-feature-flags">What are Time-based Feature Flags?</a><ul>
<li><a class="reference internal" href="#use-cases">Use Cases</a></li>
</ul>
</li>
<li><a class="reference internal" href="#date-based-conditions">Date-based Conditions</a><ul>
<li><a class="reference internal" href="#date-after-operator">DATE_AFTER Operator</a></li>
<li><a class="reference internal" href="#date-before-operator">DATE_BEFORE Operator</a></li>
<li><a class="reference internal" href="#iso-8601-datetime-format">ISO 8601 Datetime Format</a></li>
<li><a class="reference internal" href="#timezone-considerations">Timezone Considerations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recurring-time-windows">Recurring Time Windows</a><ul>
<li><a class="reference internal" href="#daily-schedules">Daily Schedules</a></li>
<li><a class="reference internal" href="#weekly-schedules">Weekly Schedules</a></li>
<li><a class="reference internal" href="#monthly-schedules">Monthly Schedules</a></li>
<li><a class="reference internal" href="#cron-expressions">CRON Expressions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scheduled-flag-changes">Scheduled Flag Changes</a><ul>
<li><a class="reference internal" href="#creating-a-scheduled-enable-disable">Creating a Scheduled Enable/Disable</a></li>
<li><a class="reference internal" href="#scheduling-rollout-percentage-changes">Scheduling Rollout Percentage Changes</a></li>
<li><a class="reference internal" href="#viewing-pending-schedules">Viewing Pending Schedules</a></li>
<li><a class="reference internal" href="#canceling-scheduled-changes">Canceling Scheduled Changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gradual-rollout-phases">Gradual Rollout Phases</a><ul>
<li><a class="reference internal" href="#setting-up-phased-rollouts">Setting Up Phased Rollouts</a></li>
<li><a class="reference internal" href="#monitoring-rollout-progress">Monitoring Rollout Progress</a></li>
<li><a class="reference internal" href="#pausing-and-resuming-rollouts">Pausing and Resuming Rollouts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li><a class="reference internal" href="#always-use-timezone-aware-datetimes">Always Use Timezone-aware Datetimes</a></li>
<li><a class="reference internal" href="#testing-scheduled-changes">Testing Scheduled Changes</a></li>
<li><a class="reference internal" href="#monitoring-scheduled-changes-in-production">Monitoring Scheduled Changes in Production</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">litestar-flags</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">User Guide</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Time-based Rules</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <article class="yue" role="main">
          <section id="time-based-rules">
<h1>Time-based Rules<a class="headerlink" href="#time-based-rules" title="Link to this heading">¶</a></h1>
<p>Time-based feature flag rules enable you to control feature availability based
on temporal conditions. Whether you need to launch a feature at a specific
moment, create maintenance windows, or set up recurring schedules, time-based
rules provide the flexibility to automate flag state changes.</p>
<section id="what-are-time-based-feature-flags">
<h2>What are Time-based Feature Flags?<a class="headerlink" href="#what-are-time-based-feature-flags" title="Link to this heading">¶</a></h2>
<p>Time-based feature flags extend traditional boolean flags with temporal
awareness. Instead of manually toggling features on and off, you can:</p>
<ul class="simple">
<li><p><strong>Schedule launches</strong>: Enable a feature at a precise future date and time</p></li>
<li><p><strong>Create maintenance windows</strong>: Temporarily disable features during planned downtime</p></li>
<li><p><strong>Implement time-limited features</strong>: Features that automatically expire</p></li>
<li><p><strong>Set up recurring availability</strong>: Features enabled only during specific hours or days</p></li>
</ul>
<section id="use-cases">
<h3>Use Cases<a class="headerlink" href="#use-cases" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt><strong>Scheduled Product Launches</strong></dt><dd><p>Launch a new feature at midnight on a specific date across all time zones
without requiring manual intervention.</p>
</dd>
<dt><strong>Maintenance Windows</strong></dt><dd><p>Automatically disable non-critical features during scheduled database
migrations or infrastructure updates.</p>
</dd>
<dt><strong>Time-limited Promotions</strong></dt><dd><p>Enable promotional features only during Black Friday weekend or other
specific time periods.</p>
</dd>
<dt><strong>Business Hours Features</strong></dt><dd><p>Features available only during customer support hours (e.g., live chat
widget visible only 9 AM - 5 PM).</p>
</dd>
<dt><strong>Gradual Time-based Rollouts</strong></dt><dd><p>Combine time-based rules with percentage rollouts to increase feature
availability over time automatically.</p>
</dd>
</dl>
</section>
</section>
<section id="date-based-conditions">
<h2>Date-based Conditions<a class="headerlink" href="#date-based-conditions" title="Link to this heading">¶</a></h2>
<p>Date-based conditions allow you to enable or disable flags based on specific
points in time. The two primary operators are <code class="docutils literal notranslate"><span class="pre">DATE_AFTER</span></code> and <code class="docutils literal notranslate"><span class="pre">DATE_BEFORE</span></code>.</p>
<section id="date-after-operator">
<h3>DATE_AFTER Operator<a class="headerlink" href="#date-after-operator" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">DATE_AFTER</span></code> operator enables a flag only after a specified datetime
has passed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.models.flag</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeatureFlag</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.models.rule</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlagRule</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagStatus</span><span class="p">,</span> <span class="n">RuleOperator</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Create a flag for a future product launch</span>
</span><span data-line="6"><span class="n">launch_flag</span> <span class="o">=</span> <span class="n">FeatureFlag</span><span class="p">(</span>
</span><span data-line="7">    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;new_checkout_v2&quot;</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;New Checkout Experience V2&quot;</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Redesigned checkout flow launching January 15, 2025&quot;</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">flag_type</span><span class="o">=</span><span class="n">FlagType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">status</span><span class="o">=</span><span class="n">FlagStatus</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">default_enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Disabled by default until launch date</span>
</span><span data-line="13"><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Create a rule that enables the flag after the launch date</span>
</span><span data-line="16"><span class="n">launch_rule</span> <span class="o">=</span> <span class="n">FlagRule</span><span class="p">(</span>
</span><span data-line="17">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;launch_date_rule&quot;</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Enable after January 15, 2025 at 9:00 AM UTC&quot;</span><span class="p">,</span>
</span><span data-line="19">    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="20">    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="21">    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="22">        <span class="p">{</span>
</span><span data-line="23">            <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;current_time&quot;</span><span class="p">,</span>
</span><span data-line="24">            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">RuleOperator</span><span class="o">.</span><span class="n">DATE_AFTER</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="25">            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-01-15T09:00:00Z&quot;</span><span class="p">,</span>
</span><span data-line="26">        <span class="p">}</span>
</span><span data-line="27">    <span class="p">],</span>
</span><span data-line="28">    <span class="n">serve_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="29"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="date-before-operator">
<h3>DATE_BEFORE Operator<a class="headerlink" href="#date-before-operator" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">DATE_BEFORE</span></code> operator enables a flag only before a specified datetime.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.models.rule</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlagRule</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">RuleOperator</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Create a rule for a time-limited beta feature</span>
</span><span data-line="5"><span class="n">beta_expiry_rule</span> <span class="o">=</span> <span class="n">FlagRule</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;beta_expiry_rule&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Beta access expires March 1, 2025&quot;</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="11">        <span class="p">{</span>
</span><span data-line="12">            <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;current_time&quot;</span><span class="p">,</span>
</span><span data-line="13">            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">RuleOperator</span><span class="o">.</span><span class="n">DATE_BEFORE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="14">            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-03-01T00:00:00Z&quot;</span><span class="p">,</span>
</span><span data-line="15">        <span class="p">}</span>
</span><span data-line="16">    <span class="p">],</span>
</span><span data-line="17">    <span class="n">serve_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="18"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Combining DATE_AFTER and DATE_BEFORE</strong></p>
<p>For a feature that should only be active during a specific window:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Feature active only during conference week</span>
</span><span data-line="2"><span class="n">conference_feature_rule</span> <span class="o">=</span> <span class="n">FlagRule</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;conference_week&quot;</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Special features during PyCon 2025&quot;</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="8">        <span class="p">{</span>
</span><span data-line="9">            <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;current_time&quot;</span><span class="p">,</span>
</span><span data-line="10">            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">RuleOperator</span><span class="o">.</span><span class="n">DATE_AFTER</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="11">            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-05-14T00:00:00Z&quot;</span><span class="p">,</span>  <span class="c1"># Start of conference</span>
</span><span data-line="12">        <span class="p">},</span>
</span><span data-line="13">        <span class="p">{</span>
</span><span data-line="14">            <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;current_time&quot;</span><span class="p">,</span>
</span><span data-line="15">            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">RuleOperator</span><span class="o">.</span><span class="n">DATE_BEFORE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="16">            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-05-18T23:59:59Z&quot;</span><span class="p">,</span>  <span class="c1"># End of conference</span>
</span><span data-line="17">        <span class="p">},</span>
</span><span data-line="18">    <span class="p">],</span>
</span><span data-line="19">    <span class="n">serve_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="20"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="iso-8601-datetime-format">
<h3>ISO 8601 Datetime Format<a class="headerlink" href="#iso-8601-datetime-format" title="Link to this heading">¶</a></h3>
<p>All datetime values in time-based rules <strong>must</strong> use the ISO 8601 format.
The format follows this pattern:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">YYYY-MM-DDTHH:MM:SSZ        # UTC timezone
</span><span data-line="2">YYYY-MM-DDTHH:MM:SS+HH:MM   # Positive offset from UTC
</span><span data-line="3">YYYY-MM-DDTHH:MM:SS-HH:MM   # Negative offset from UTC
</span></pre></div>
</div>
<p>Examples:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Format</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">2025-01-15T09:00:00Z</span></code></p></td>
<td><p>January 15, 2025 at 9:00 AM UTC</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">2025-01-15T09:00:00+05:30</span></code></p></td>
<td><p>January 15, 2025 at 9:00 AM IST</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">2025-01-15T09:00:00-08:00</span></code></p></td>
<td><p>January 15, 2025 at 9:00 AM PST</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="timezone-considerations">
<h3>Timezone Considerations<a class="headerlink" href="#timezone-considerations" title="Link to this heading">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Always use timezone-aware datetimes. Naive datetimes (without timezone info)
can lead to unpredictable behavior depending on server configuration.</p>
</div>
<p>Best practices for handling timezones:</p>
<ol class="arabic simple">
<li><p><strong>Store all times in UTC</strong>: Use the <code class="docutils literal notranslate"><span class="pre">Z</span></code> suffix or <code class="docutils literal notranslate"><span class="pre">+00:00</span></code> offset</p></li>
<li><p><strong>Convert on display</strong>: Transform to user’s local timezone only for display</p></li>
<li><p><strong>Be explicit</strong>: When communicating with stakeholders, always specify the timezone</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Good: Explicit UTC timezone</span>
</span><span data-line="4"><span class="n">launch_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span data-line="5"><span class="n">launch_time_str</span> <span class="o">=</span> <span class="n">launch_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>  <span class="c1"># &quot;2025-01-15T09:00:00+00:00&quot;</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Good: Convert from local to UTC before storing</span>
</span><span data-line="8"><span class="kn">import</span><span class="w"> </span><span class="nn">zoneinfo</span>
</span><span data-line="9">
</span><span data-line="10"><span class="n">local_tz</span> <span class="o">=</span> <span class="n">zoneinfo</span><span class="o">.</span><span class="n">ZoneInfo</span><span class="p">(</span><span class="s2">&quot;America/New_York&quot;</span><span class="p">)</span>
</span><span data-line="11"><span class="n">local_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">local_tz</span><span class="p">)</span>
</span><span data-line="12"><span class="n">utc_time</span> <span class="o">=</span> <span class="n">local_time</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># Bad: Naive datetime (no timezone)</span>
</span><span data-line="15"><span class="c1"># launch_time = datetime(2025, 1, 15, 9, 0, 0)  # Avoid this!</span>
</span></pre></div>
</div>
</section>
</section>
<section id="recurring-time-windows">
<h2>Recurring Time Windows<a class="headerlink" href="#recurring-time-windows" title="Link to this heading">¶</a></h2>
<p>Recurring time windows enable features on a repeating schedule rather than
at fixed points in time. This is useful for features that should only be
active during specific hours, days, or periods.</p>
<section id="daily-schedules">
<h3>Daily Schedules<a class="headerlink" href="#daily-schedules" title="Link to this heading">¶</a></h3>
<p>Enable features during specific hours each day:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.models.rule</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlagRule</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">RuleOperator</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Live chat widget available during business hours (9 AM - 6 PM UTC)</span>
</span><span data-line="5"><span class="n">business_hours_rule</span> <span class="o">=</span> <span class="n">FlagRule</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;business_hours&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Enable during business hours&quot;</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="11">        <span class="p">{</span>
</span><span data-line="12">            <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;current_time&quot;</span><span class="p">,</span>
</span><span data-line="13">            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">RuleOperator</span><span class="o">.</span><span class="n">TIME_WINDOW</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="14">            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="15">                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;daily&quot;</span><span class="p">,</span>
</span><span data-line="16">                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;09:00:00&quot;</span><span class="p">,</span>
</span><span data-line="17">                <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;18:00:00&quot;</span><span class="p">,</span>
</span><span data-line="18">                <span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="s2">&quot;UTC&quot;</span><span class="p">,</span>
</span><span data-line="19">            <span class="p">},</span>
</span><span data-line="20">        <span class="p">}</span>
</span><span data-line="21">    <span class="p">],</span>
</span><span data-line="22">    <span class="n">serve_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="23"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="weekly-schedules">
<h3>Weekly Schedules<a class="headerlink" href="#weekly-schedules" title="Link to this heading">¶</a></h3>
<p>Enable features only on specific days of the week:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Flash sale features active only on weekends</span>
</span><span data-line="2"><span class="n">weekend_sale_rule</span> <span class="o">=</span> <span class="n">FlagRule</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;weekend_sale&quot;</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Weekend flash sales&quot;</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="8">        <span class="p">{</span>
</span><span data-line="9">            <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;current_time&quot;</span><span class="p">,</span>
</span><span data-line="10">            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">RuleOperator</span><span class="o">.</span><span class="n">TIME_WINDOW</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="11">            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="12">                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;weekly&quot;</span><span class="p">,</span>
</span><span data-line="13">                <span class="s2">&quot;days_of_week&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;saturday&quot;</span><span class="p">,</span> <span class="s2">&quot;sunday&quot;</span><span class="p">],</span>
</span><span data-line="14">                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;00:00:00&quot;</span><span class="p">,</span>
</span><span data-line="15">                <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;23:59:59&quot;</span><span class="p">,</span>
</span><span data-line="16">                <span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="s2">&quot;America/New_York&quot;</span><span class="p">,</span>
</span><span data-line="17">            <span class="p">},</span>
</span><span data-line="18">        <span class="p">}</span>
</span><span data-line="19">    <span class="p">],</span>
</span><span data-line="20">    <span class="n">serve_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="21"><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Support chat available Monday through Friday, 9 AM - 5 PM</span>
</span><span data-line="24"><span class="n">weekday_support_rule</span> <span class="o">=</span> <span class="n">FlagRule</span><span class="p">(</span>
</span><span data-line="25">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;weekday_support&quot;</span><span class="p">,</span>
</span><span data-line="26">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Weekday support hours&quot;</span><span class="p">,</span>
</span><span data-line="27">    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="28">    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="29">    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="30">        <span class="p">{</span>
</span><span data-line="31">            <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;current_time&quot;</span><span class="p">,</span>
</span><span data-line="32">            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">RuleOperator</span><span class="o">.</span><span class="n">TIME_WINDOW</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="33">            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="34">                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;weekly&quot;</span><span class="p">,</span>
</span><span data-line="35">                <span class="s2">&quot;days_of_week&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;monday&quot;</span><span class="p">,</span> <span class="s2">&quot;tuesday&quot;</span><span class="p">,</span> <span class="s2">&quot;wednesday&quot;</span><span class="p">,</span> <span class="s2">&quot;thursday&quot;</span><span class="p">,</span> <span class="s2">&quot;friday&quot;</span><span class="p">],</span>
</span><span data-line="36">                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;09:00:00&quot;</span><span class="p">,</span>
</span><span data-line="37">                <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;17:00:00&quot;</span><span class="p">,</span>
</span><span data-line="38">                <span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span>
</span><span data-line="39">            <span class="p">},</span>
</span><span data-line="40">        <span class="p">}</span>
</span><span data-line="41">    <span class="p">],</span>
</span><span data-line="42">    <span class="n">serve_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="43"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="monthly-schedules">
<h3>Monthly Schedules<a class="headerlink" href="#monthly-schedules" title="Link to this heading">¶</a></h3>
<p>Enable features on specific days of the month:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Payroll features active on the 1st and 15th of each month</span>
</span><span data-line="2"><span class="n">payroll_rule</span> <span class="o">=</span> <span class="n">FlagRule</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;payroll_days&quot;</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Enhanced payroll features on pay days&quot;</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="8">        <span class="p">{</span>
</span><span data-line="9">            <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;current_time&quot;</span><span class="p">,</span>
</span><span data-line="10">            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">RuleOperator</span><span class="o">.</span><span class="n">TIME_WINDOW</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="11">            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="12">                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly&quot;</span><span class="p">,</span>
</span><span data-line="13">                <span class="s2">&quot;days_of_month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
</span><span data-line="14">                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;00:00:00&quot;</span><span class="p">,</span>
</span><span data-line="15">                <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;23:59:59&quot;</span><span class="p">,</span>
</span><span data-line="16">                <span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="s2">&quot;UTC&quot;</span><span class="p">,</span>
</span><span data-line="17">            <span class="p">},</span>
</span><span data-line="18">        <span class="p">}</span>
</span><span data-line="19">    <span class="p">],</span>
</span><span data-line="20">    <span class="n">serve_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="21"><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># End-of-month reporting features (last 3 days)</span>
</span><span data-line="24"><span class="n">eom_reporting_rule</span> <span class="o">=</span> <span class="n">FlagRule</span><span class="p">(</span>
</span><span data-line="25">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;eom_reporting&quot;</span><span class="p">,</span>
</span><span data-line="26">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;End of month reporting tools&quot;</span><span class="p">,</span>
</span><span data-line="27">    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="28">    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="29">    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="30">        <span class="p">{</span>
</span><span data-line="31">            <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;current_time&quot;</span><span class="p">,</span>
</span><span data-line="32">            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">RuleOperator</span><span class="o">.</span><span class="n">TIME_WINDOW</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="33">            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="34">                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly&quot;</span><span class="p">,</span>
</span><span data-line="35">                <span class="s2">&quot;days_of_month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># Last 3 days (negative indexing)</span>
</span><span data-line="36">                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;00:00:00&quot;</span><span class="p">,</span>
</span><span data-line="37">                <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;23:59:59&quot;</span><span class="p">,</span>
</span><span data-line="38">                <span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="s2">&quot;UTC&quot;</span><span class="p">,</span>
</span><span data-line="39">            <span class="p">},</span>
</span><span data-line="40">        <span class="p">}</span>
</span><span data-line="41">    <span class="p">],</span>
</span><span data-line="42">    <span class="n">serve_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="43"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="cron-expressions">
<h3>CRON Expressions<a class="headerlink" href="#cron-expressions" title="Link to this heading">¶</a></h3>
<p>For complex recurring schedules, use CRON expressions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">RecurrenceType</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Complex schedule: Every Tuesday and Thursday, 2-4 PM</span>
</span><span data-line="4"><span class="n">training_mode_rule</span> <span class="o">=</span> <span class="n">FlagRule</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;training_mode&quot;</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Training mode during scheduled sessions&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="10">        <span class="p">{</span>
</span><span data-line="11">            <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="s2">&quot;current_time&quot;</span><span class="p">,</span>
</span><span data-line="12">            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">RuleOperator</span><span class="o">.</span><span class="n">TIME_WINDOW</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="13">            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="14">                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;cron&quot;</span><span class="p">,</span>
</span><span data-line="15">                <span class="s2">&quot;cron_expression&quot;</span><span class="p">:</span> <span class="s2">&quot;0 14-16 * * 2,4&quot;</span><span class="p">,</span>  <span class="c1"># Min Hour Day Month DayOfWeek</span>
</span><span data-line="16">                <span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="s2">&quot;America/New_York&quot;</span><span class="p">,</span>
</span><span data-line="17">            <span class="p">},</span>
</span><span data-line="18">        <span class="p">}</span>
</span><span data-line="19">    <span class="p">],</span>
</span><span data-line="20">    <span class="n">serve_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="21"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>CRON Expression Format</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">* * * * *
</span><span data-line="2">| | | | |
</span><span data-line="3">| | | | +-- Day of week (0-6, Sunday=0)
</span><span data-line="4">| | | +---- Month (1-12)
</span><span data-line="5">| | +------ Day of month (1-31)
</span><span data-line="6">| +-------- Hour (0-23)
</span><span data-line="7">+---------- Minute (0-59)
</span></pre></div>
</div>
<p>Common CRON patterns:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Expression</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">9</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">1-5</span></code></p></td>
<td><p>9 AM, Monday through Friday</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">*</span> <span class="pre">*</span></code></p></td>
<td><p>Midnight on the 1st of each month</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">*/2</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span></code></p></td>
<td><p>Every 2 hours</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">9-17</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">1-5</span></code></p></td>
<td><p>Every hour from 9 AM to 5 PM, weekdays</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="scheduled-flag-changes">
<h2>Scheduled Flag Changes<a class="headerlink" href="#scheduled-flag-changes" title="Link to this heading">¶</a></h2>
<p>Scheduled flag changes allow you to queue future modifications to your flags.
This is useful for planned launches, deprecations, and automated rollout
progression.</p>
<section id="creating-a-scheduled-enable-disable">
<h3>Creating a Scheduled Enable/Disable<a class="headerlink" href="#creating-a-scheduled-enable-disable" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChangeType</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Schedule a flag to be enabled in 24 hours</span>
</span><span data-line="5"><span class="n">scheduled_change</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="6">    <span class="s2">&quot;flag_key&quot;</span><span class="p">:</span> <span class="s2">&quot;new_feature&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="s2">&quot;change_type&quot;</span><span class="p">:</span> <span class="n">ChangeType</span><span class="o">.</span><span class="n">ENABLE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="8">    <span class="s2">&quot;scheduled_at&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span data-line="9">    <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Scheduled launch after QA approval&quot;</span><span class="p">,</span>
</span><span data-line="10">    <span class="s2">&quot;created_by&quot;</span><span class="p">:</span> <span class="s2">&quot;release-manager@example.com&quot;</span><span class="p">,</span>
</span><span data-line="11"><span class="p">}</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># To create via storage backend (when implemented)</span>
</span><span data-line="14"><span class="c1"># await storage.create_scheduled_change(scheduled_change)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Schedule a flag to be disabled for maintenance</span>
</span><span data-line="17"><span class="n">maintenance_change</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="18">    <span class="s2">&quot;flag_key&quot;</span><span class="p">:</span> <span class="s2">&quot;api_integration&quot;</span><span class="p">,</span>
</span><span data-line="19">    <span class="s2">&quot;change_type&quot;</span><span class="p">:</span> <span class="n">ChangeType</span><span class="o">.</span><span class="n">DISABLE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="20">    <span class="s2">&quot;scheduled_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-02-15T02:00:00Z&quot;</span><span class="p">,</span>  <span class="c1"># 2 AM UTC</span>
</span><span data-line="21">    <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Scheduled maintenance window&quot;</span><span class="p">,</span>
</span><span data-line="22">    <span class="s2">&quot;auto_revert_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-02-15T04:00:00Z&quot;</span><span class="p">,</span>  <span class="c1"># Re-enable at 4 AM UTC</span>
</span><span data-line="23">    <span class="s2">&quot;created_by&quot;</span><span class="p">:</span> <span class="s2">&quot;ops-team@example.com&quot;</span><span class="p">,</span>
</span><span data-line="24"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<section id="scheduling-rollout-percentage-changes">
<h3>Scheduling Rollout Percentage Changes<a class="headerlink" href="#scheduling-rollout-percentage-changes" title="Link to this heading">¶</a></h3>
<p>Combine scheduled changes with percentage rollouts for gradual, automated
increases:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChangeType</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Current time as base</span>
</span><span data-line="5"><span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Schedule a series of rollout increases</span>
</span><span data-line="8"><span class="n">rollout_schedule</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="9">    <span class="p">{</span>
</span><span data-line="10">        <span class="s2">&quot;flag_key&quot;</span><span class="p">:</span> <span class="s2">&quot;new_checkout_flow&quot;</span><span class="p">,</span>
</span><span data-line="11">        <span class="s2">&quot;change_type&quot;</span><span class="p">:</span> <span class="n">ChangeType</span><span class="o">.</span><span class="n">UPDATE_ROLLOUT</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="12">        <span class="s2">&quot;scheduled_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span data-line="13">        <span class="s2">&quot;rollout_percentage&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span data-line="14">        <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Initial rollout to 5%&quot;</span><span class="p">,</span>
</span><span data-line="15">    <span class="p">},</span>
</span><span data-line="16">    <span class="p">{</span>
</span><span data-line="17">        <span class="s2">&quot;flag_key&quot;</span><span class="p">:</span> <span class="s2">&quot;new_checkout_flow&quot;</span><span class="p">,</span>
</span><span data-line="18">        <span class="s2">&quot;change_type&quot;</span><span class="p">:</span> <span class="n">ChangeType</span><span class="o">.</span><span class="n">UPDATE_ROLLOUT</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="19">        <span class="s2">&quot;scheduled_at&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span data-line="20">        <span class="s2">&quot;rollout_percentage&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
</span><span data-line="21">        <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Increase to 25</span><span class="si">% a</span><span class="s2">fter 1 week monitoring&quot;</span><span class="p">,</span>
</span><span data-line="22">    <span class="p">},</span>
</span><span data-line="23">    <span class="p">{</span>
</span><span data-line="24">        <span class="s2">&quot;flag_key&quot;</span><span class="p">:</span> <span class="s2">&quot;new_checkout_flow&quot;</span><span class="p">,</span>
</span><span data-line="25">        <span class="s2">&quot;change_type&quot;</span><span class="p">:</span> <span class="n">ChangeType</span><span class="o">.</span><span class="n">UPDATE_ROLLOUT</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="26">        <span class="s2">&quot;scheduled_at&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">))</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span data-line="27">        <span class="s2">&quot;rollout_percentage&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
</span><span data-line="28">        <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Increase to 50</span><span class="si">% a</span><span class="s2">fter 2 weeks&quot;</span><span class="p">,</span>
</span><span data-line="29">    <span class="p">},</span>
</span><span data-line="30">    <span class="p">{</span>
</span><span data-line="31">        <span class="s2">&quot;flag_key&quot;</span><span class="p">:</span> <span class="s2">&quot;new_checkout_flow&quot;</span><span class="p">,</span>
</span><span data-line="32">        <span class="s2">&quot;change_type&quot;</span><span class="p">:</span> <span class="n">ChangeType</span><span class="o">.</span><span class="n">UPDATE_ROLLOUT</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="33">        <span class="s2">&quot;scheduled_at&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">21</span><span class="p">))</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span data-line="34">        <span class="s2">&quot;rollout_percentage&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
</span><span data-line="35">        <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Full rollout after 3 weeks&quot;</span><span class="p">,</span>
</span><span data-line="36">    <span class="p">},</span>
</span><span data-line="37"><span class="p">]</span>
</span><span data-line="38">
</span><span data-line="39"><span class="c1"># Register all scheduled changes</span>
</span><span data-line="40"><span class="c1"># for change in rollout_schedule:</span>
</span><span data-line="41"><span class="c1">#     await storage.create_scheduled_change(change)</span>
</span></pre></div>
</div>
</section>
<section id="viewing-pending-schedules">
<h3>Viewing Pending Schedules<a class="headerlink" href="#viewing-pending-schedules" title="Link to this heading">¶</a></h3>
<p>Query pending scheduled changes for visibility and auditing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># List all pending scheduled changes for a flag</span>
</span><span data-line="2"><span class="c1"># pending_changes = await storage.list_scheduled_changes(</span>
</span><span data-line="3"><span class="c1">#     flag_key=&quot;new_checkout_flow&quot;,</span>
</span><span data-line="4"><span class="c1">#     status=&quot;pending&quot;,</span>
</span><span data-line="5"><span class="c1"># )</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># List all scheduled changes in a time range</span>
</span><span data-line="8"><span class="c1"># upcoming_changes = await storage.list_scheduled_changes(</span>
</span><span data-line="9"><span class="c1">#     scheduled_after=datetime.now(timezone.utc),</span>
</span><span data-line="10"><span class="c1">#     scheduled_before=datetime.now(timezone.utc) + timedelta(days=7),</span>
</span><span data-line="11"><span class="c1"># )</span>
</span></pre></div>
</div>
</section>
<section id="canceling-scheduled-changes">
<h3>Canceling Scheduled Changes<a class="headerlink" href="#canceling-scheduled-changes" title="Link to this heading">¶</a></h3>
<p>Remove scheduled changes that are no longer needed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Cancel a specific scheduled change by ID</span>
</span><span data-line="2"><span class="c1"># await storage.cancel_scheduled_change(</span>
</span><span data-line="3"><span class="c1">#     change_id=&quot;change-uuid-here&quot;,</span>
</span><span data-line="4"><span class="c1">#     reason=&quot;Feature postponed due to dependency issues&quot;,</span>
</span><span data-line="5"><span class="c1">#     canceled_by=&quot;product-manager@example.com&quot;,</span>
</span><span data-line="6"><span class="c1"># )</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Cancel all pending changes for a flag</span>
</span><span data-line="9"><span class="c1"># await storage.cancel_all_scheduled_changes(</span>
</span><span data-line="10"><span class="c1">#     flag_key=&quot;new_checkout_flow&quot;,</span>
</span><span data-line="11"><span class="c1">#     reason=&quot;Feature cancelled&quot;,</span>
</span><span data-line="12"><span class="c1">#     canceled_by=&quot;product-manager@example.com&quot;,</span>
</span><span data-line="13"><span class="c1"># )</span>
</span></pre></div>
</div>
</section>
</section>
<section id="gradual-rollout-phases">
<h2>Gradual Rollout Phases<a class="headerlink" href="#gradual-rollout-phases" title="Link to this heading">¶</a></h2>
<p>For complex rollouts, litestar-flags provides a workflow-based approach with
predefined stages. This builds on the <code class="docutils literal notranslate"><span class="pre">ScheduledRolloutWorkflow</span></code> from the
workflows module.</p>
<section id="setting-up-phased-rollouts">
<h3>Setting Up Phased Rollouts<a class="headerlink" href="#setting-up-phased-rollouts" title="Link to this heading">¶</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">ScheduledRolloutWorkflow</span></code> for automated, staged rollouts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.contrib.workflows</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScheduledRolloutWorkflow</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.contrib.workflows.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">RolloutStage</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Get the workflow definition with custom timing</span>
</span><span data-line="5"><span class="n">workflow_def</span> <span class="o">=</span> <span class="n">ScheduledRolloutWorkflow</span><span class="o">.</span><span class="n">get_definition</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">storage</span><span class="o">=</span><span class="n">storage</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">stage_delay_minutes</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>  <span class="c1"># 1 hour between stages</span>
</span><span data-line="8">    <span class="n">stages</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="9">        <span class="n">RolloutStage</span><span class="o">.</span><span class="n">INITIAL</span><span class="p">,</span>    <span class="c1"># 5%</span>
</span><span data-line="10">        <span class="n">RolloutStage</span><span class="o">.</span><span class="n">EARLY</span><span class="p">,</span>      <span class="c1"># 25%</span>
</span><span data-line="11">        <span class="n">RolloutStage</span><span class="o">.</span><span class="n">HALF</span><span class="p">,</span>       <span class="c1"># 50%</span>
</span><span data-line="12">        <span class="n">RolloutStage</span><span class="o">.</span><span class="n">MAJORITY</span><span class="p">,</span>   <span class="c1"># 75%</span>
</span><span data-line="13">        <span class="n">RolloutStage</span><span class="o">.</span><span class="n">FULL</span><span class="p">,</span>       <span class="c1"># 100%</span>
</span><span data-line="14">    <span class="p">],</span>
</span><span data-line="15"><span class="p">)</span>
</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">RolloutStage</span></code> enum defines standard percentages:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Stage</p></th>
<th class="head"><p>Percentage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">INITIAL</span></code></p></td>
<td><p>5%</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">EARLY</span></code></p></td>
<td><p>25%</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">HALF</span></code></p></td>
<td><p>50%</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">MAJORITY</span></code></p></td>
<td><p>75%</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">FULL</span></code></p></td>
<td><p>100%</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="monitoring-rollout-progress">
<h3>Monitoring Rollout Progress<a class="headerlink" href="#monitoring-rollout-progress" title="Link to this heading">¶</a></h3>
<p>Track the status of ongoing rollouts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Query current rollout status (conceptual example)</span>
</span><span data-line="2"><span class="c1"># status = await workflow_engine.get_instance_status(instance_id)</span>
</span><span data-line="3"><span class="c1"># print(f&quot;Current stage: {status.current_step}&quot;)</span>
</span><span data-line="4"><span class="c1"># print(f&quot;Current percentage: {status.context.get(&#39;current_percentage&#39;)}&quot;)</span>
</span><span data-line="5"><span class="c1"># print(f&quot;Next stage scheduled: {status.context.get(&#39;next_stage_at&#39;)}&quot;)</span>
</span></pre></div>
</div>
</section>
<section id="pausing-and-resuming-rollouts">
<h3>Pausing and Resuming Rollouts<a class="headerlink" href="#pausing-and-resuming-rollouts" title="Link to this heading">¶</a></h3>
<p>If issues are detected, pause the rollout workflow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Pause a rollout (workflow-based approach)</span>
</span><span data-line="2"><span class="c1"># await workflow_engine.pause_instance(</span>
</span><span data-line="3"><span class="c1">#     instance_id=instance_id,</span>
</span><span data-line="4"><span class="c1">#     reason=&quot;Performance degradation detected at 25% rollout&quot;,</span>
</span><span data-line="5"><span class="c1">#     paused_by=&quot;sre-team@example.com&quot;,</span>
</span><span data-line="6"><span class="c1"># )</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Resume when ready</span>
</span><span data-line="9"><span class="c1"># await workflow_engine.resume_instance(</span>
</span><span data-line="10"><span class="c1">#     instance_id=instance_id,</span>
</span><span data-line="11"><span class="c1">#     reason=&quot;Performance issues resolved&quot;,</span>
</span><span data-line="12"><span class="c1">#     resumed_by=&quot;sre-team@example.com&quot;,</span>
</span><span data-line="13"><span class="c1"># )</span>
</span></pre></div>
</div>
<p>For immediate rollback without pausing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_flags.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeatureFlagClient</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">emergency_rollback</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">FeatureFlagClient</span><span class="p">,</span> <span class="n">flag_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Immediately disable a flag during an incident.&quot;&quot;&quot;</span>
</span><span data-line="5">    <span class="n">flag</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="n">flag_key</span><span class="p">)</span>
</span><span data-line="6">    <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
</span><span data-line="7">        <span class="n">flag</span><span class="o">.</span><span class="n">default_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="8">        <span class="n">flag</span><span class="o">.</span><span class="n">rollout_percentage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="9">        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">update_flag</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">¶</a></h2>
<section id="always-use-timezone-aware-datetimes">
<h3>Always Use Timezone-aware Datetimes<a class="headerlink" href="#always-use-timezone-aware-datetimes" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># CORRECT: Timezone-aware datetime</span>
</span><span data-line="4"><span class="n">scheduled_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># INCORRECT: Naive datetime - avoid this!</span>
</span><span data-line="7"><span class="c1"># scheduled_at = datetime(2025, 1, 15, 9, 0, 0)</span>
</span></pre></div>
</div>
<p>For consistent behavior across different server configurations and deployments,
always include timezone information. UTC is recommended for storage; convert
to local timezones only for display purposes.</p>
</section>
<section id="testing-scheduled-changes">
<h3>Testing Scheduled Changes<a class="headerlink" href="#testing-scheduled-changes" title="Link to this heading">¶</a></h3>
<p>Test time-based logic by mocking the current time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">unittest.mock</span><span class="w"> </span><span class="kn">import</span> <span class="n">patch</span>
</span><span data-line="4">
</span><span data-line="5"><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
</span><span data-line="6"><span class="k">def</span><span class="w"> </span><span class="nf">mock_current_time</span><span class="p">():</span>
</span><span data-line="7"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fixture to mock current time for testing.&quot;&quot;&quot;</span>
</span><span data-line="8">    <span class="k">def</span><span class="w"> </span><span class="nf">_mock_time</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span data-line="9">        <span class="n">mock_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span data-line="10">        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;litestar_flags.engine.datetime&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_datetime</span><span class="p">:</span>
</span><span data-line="11">            <span class="n">mock_datetime</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_dt</span>
</span><span data-line="12">            <span class="n">mock_datetime</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="13">            <span class="k">yield</span> <span class="n">mock_dt</span>
</span><span data-line="14">    <span class="k">return</span> <span class="n">_mock_time</span>
</span><span data-line="15">
</span><span data-line="16"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_scheduled_launch</span><span class="p">(</span><span class="n">mock_current_time</span><span class="p">,</span> <span class="n">feature_client</span><span class="p">):</span>
</span><span data-line="17"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that a flag activates after its scheduled launch date.&quot;&quot;&quot;</span>
</span><span data-line="18">    <span class="c1"># Before launch date</span>
</span><span data-line="19">    <span class="k">with</span> <span class="n">mock_current_time</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">):</span>
</span><span data-line="20">        <span class="k">assert</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">feature_client</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">(</span><span class="s2">&quot;new_feature&quot;</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22">    <span class="c1"># After launch date</span>
</span><span data-line="23">    <span class="k">with</span> <span class="n">mock_current_time</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span data-line="24">        <span class="k">assert</span> <span class="k">await</span> <span class="n">feature_client</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">(</span><span class="s2">&quot;new_feature&quot;</span><span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_time_window</span><span class="p">(</span><span class="n">mock_current_time</span><span class="p">,</span> <span class="n">feature_client</span><span class="p">):</span>
</span><span data-line="27"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that a flag respects business hours.&quot;&quot;&quot;</span>
</span><span data-line="28">    <span class="c1"># During business hours</span>
</span><span data-line="29">    <span class="k">with</span> <span class="n">mock_current_time</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>  <span class="c1"># 2 PM</span>
</span><span data-line="30">        <span class="k">assert</span> <span class="k">await</span> <span class="n">feature_client</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">(</span><span class="s2">&quot;business_hours_feature&quot;</span><span class="p">)</span>
</span><span data-line="31">
</span><span data-line="32">    <span class="c1"># Outside business hours</span>
</span><span data-line="33">    <span class="k">with</span> <span class="n">mock_current_time</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>  <span class="c1"># 10 PM</span>
</span><span data-line="34">        <span class="k">assert</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">feature_client</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">(</span><span class="s2">&quot;business_hours_feature&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="monitoring-scheduled-changes-in-production">
<h3>Monitoring Scheduled Changes in Production<a class="headerlink" href="#monitoring-scheduled-changes-in-production" title="Link to this heading">¶</a></h3>
<p>Set up alerting and monitoring for scheduled changes:</p>
<ol class="arabic">
<li><p><strong>Alert on upcoming changes</strong>: Notify stakeholders before scheduled launches</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_upcoming_changes</span><span class="p">(</span><span class="n">storage</span><span class="p">,</span> <span class="n">hours_ahead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">24</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span data-line="4"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find changes happening in the next N hours.&quot;&quot;&quot;</span>
</span><span data-line="5">    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span data-line="6">    <span class="n">upcoming</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">hours_ahead</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8">    <span class="c1"># Query for upcoming changes (conceptual)</span>
</span><span data-line="9">    <span class="c1"># return await storage.list_scheduled_changes(</span>
</span><span data-line="10">    <span class="c1">#     scheduled_after=now,</span>
</span><span data-line="11">    <span class="c1">#     scheduled_before=upcoming,</span>
</span><span data-line="12">    <span class="c1">#     status=&quot;pending&quot;,</span>
</span><span data-line="13">    <span class="c1"># )</span>
</span><span data-line="14">    <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>
</div>
</li>
<li><p><strong>Log all scheduled executions</strong>: Track when scheduled changes are applied</p></li>
<li><p><strong>Monitor rollout metrics</strong>: Track error rates and performance at each stage</p></li>
<li><p><strong>Set up automatic rollback triggers</strong>: Define thresholds that pause or
revert rollouts automatically</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Example: Automatic rollback based on error rate</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">monitor_rollout_health</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">flag_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">error_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>  <span class="c1"># 5% error rate</span>
</span><span data-line="5"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="6"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if rollout is healthy; return False if rollback needed.&quot;&quot;&quot;</span>
</span><span data-line="7">    <span class="c1"># Get current error rate from your monitoring system</span>
</span><span data-line="8">    <span class="c1"># current_error_rate = await metrics.get_error_rate(flag_key)</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="c1"># if current_error_rate &gt; error_threshold:</span>
</span><span data-line="11">    <span class="c1">#     await pause_rollout(flag_key)</span>
</span><span data-line="12">    <span class="c1">#     await notify_team(f&quot;Rollout paused: {flag_key} error rate {current_error_rate}&quot;)</span>
</span><span data-line="13">    <span class="c1">#     return False</span>
</span><span data-line="14">
</span><span data-line="15">    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>
</div>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../guides/percentage-rollouts.html"><span class="doc">Percentage Rollouts</span></a> - Percentage-based rollout fundamentals</p></li>
<li><p><a class="reference internal" href="../guides/user-targeting.html"><span class="doc">User Targeting</span></a> - Targeting specific users with rules</p></li>
<li><p><a class="reference internal" href="../guides/workflows.html"><span class="doc">Approval Workflows</span></a> - Approval workflows and governance</p></li>
<li><p><a class="reference internal" href="../api/types.html"><span class="doc">Types and Enums</span></a> - Reference for <code class="docutils literal notranslate"><span class="pre">RuleOperator</span></code>, <code class="docutils literal notranslate"><span class="pre">ChangeType</span></code>, and other enums</p></li>
</ul>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="openfeature.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">OpenFeature Integration</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="multi-environment.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Multi-Environment Support</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2026, Jacob Coffee</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/JacobCoffee/litestar-flags" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=30646c52"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script></body>
</html>